<th:block th:fragment="fragment-productList">
  <section id="portfolio" class="portfolio section">
    <div class="container section-title" data-aos="fade-up">
      <h2></h2>
      <p><span>Brewit의&nbsp;</span> <span class="description-title">인기 제품</span></p>
    </div>

    <div class="container">
      <div class="isotope-layout" data-default-filter="*" data-layout="masonry" data-sort="original-order">
        <ul class="portfolio-filters isotope-filters" data-aos="fade-up" data-aos-delay="100">
          <li class="filter-active" onclick="fetchProducts('best')">Best</li>
          <li onclick="fetchProducts('tea')">차(Tea)</li>
          <li onclick="fetchProducts('coffee')">커피</li>
          <li onclick="fetchProducts('tool')">관련용품</li>
        </ul>

        <div class="row gy-4 isotope-container" id="product-container" data-aos="fade-up" data-aos-delay="200"
             style="min-height: 860px;">
          <!-- 동적으로 데이터가 들어갈 영역 -->
          <script>
            // API 호출 및 HTML 생성
            async function fetchProducts(tab_id) {
              const response = await fetch(`/products?tab_id=${tab_id}`);
              const products = await response.json();
              console.log("tab_id: " + tab_id);
              console.log("products: " + products);

              const container = document.getElementById("product-container");
              container.innerHTML = ""; // 기존 데이터를 지움

              switch (tab_id) {
                case "best":
                  return products.forEach(productDTO => {
                    const item = document.createElement("div");
                    item.className = `col-lg-4 col-md-6 portfolio-item isotope-item filter-${tab_id}`;
                    item.innerHTML = `
                      <img src="/img/product/${productDTO.attach_name}" class="img-fluid" alt="${productDTO.name}" href="">
                      <div class="portfolio-info">
                          <h4>${productDTO.name}</h4>
                          <p>liked: ${productDTO.liked} / 가격: ${productDTO.sale_price}원</p>
                          <a href="/${tab_id}/${productDTO.category_id}/${productDTO.subcategory_id}/${productDTO.product_id}" title="${productDTO.name}" data-gallery="portfolio-gallery-${tab_id}" class="glightbox preview-link">
                              <i class="bi bi-zoom-in"></i>
                          </a>
                      </div>
                    `;
                    container.appendChild(item);
                  });
                case "tool":
                  return products.forEach(productDTO => {
                    const item = document.createElement("div");
                    item.className = `col-lg-4 col-md-6 portfolio-item isotope-item filter-${tab_id}`;
                    item.innerHTML = `
                      <img src="/img/product/${productDTO.attach_name}" class="img-fluid" alt="${productDTO.name}">
                      <div class="portfolio-info">
                          <h4>${productDTO.name}</h4>
                          <p>liked: ${productDTO} / 가격: ${productDTO.sale_price}원</p>
                          <a href="/${tab_id}/${productDTO.mainsubcategory_id}/${productDTO.subcategory_id}/${productDTO.product_id}" title="${productDTO.name}" data-gallery="portfolio-gallery-${tab_id}" class="glightbox preview-link">
                              <i class="bi bi-zoom-in"></i>
                          </a>
                      </div>
                    `;
                    container.appendChild(item);
                  });
                case "tea": case "coffee":
                  return products.forEach(productDTO => {
                    const item = document.createElement("div");
                    item.className = `col-lg-4 col-md-6 portfolio-item isotope-item filter-${tab_id}`;
                    item.innerHTML = `
                      <img src="/img/product/${productDTO.attach_name}" class="img-fluid" alt="${productDTO.name}">
                      <div class="portfolio-info">
                          <h4>${productDTO.name}</h4>
                          <p>liked: ${productDTO.liked} / 가격: ${productDTO.sale_price}원</p>
                          <a href="/${tab_id}/${productDTO.mainsubcategory_id}/${productDTO.product_id}" title="${productDTO.name}" data-gallery="portfolio-gallery-${tab_id}" class="glightbox preview-link">
                              <i class="bi bi-zoom-in"></i>
                          </a>
                      </div>
                    `;
                    container.appendChild(item);
                  });
              }
            }
            // 초기 데이터 로드 (All 탭)
            document.addEventListener("DOMContentLoaded", () => fetchProducts("best"));
          </script>
        </div>
      </div>
    </div>
  </section>
</th:block>
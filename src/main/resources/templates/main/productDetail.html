<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<!-- Header Fragments -->
<th:block th:replace="~{/main/fragments/header :: fragment-header}"></th:block>
<!-- Header Fragments Close -->

<body>
<link href="/main/assets/css/productDetail.css" rel="stylesheet">

<div class="container mt-5">
    <div class="row gy-4">
        <!-- 상품 상세 정보 -->
        <div class="col-lg-6 d-flex align-items-stretch">
            <form action="" th:action method="post" enctype="multipart/form-data">
                <div class="team-member">
                    <!-- 상품 이미지 -->
                    <div class="member-img">
                        <img th:src="@{/img/product/{attach_name}(attach_name=${productDetail.attach_name})}" class="img-fluid img-set" th:alt="${productDetail.attach_name}">
                    </div>
                </div>
            </form>
        </div>

        <!-- 상품 정보 영역 -->
        <div class="col-lg-6 d-flex align-items-stretch">
            <div class="member-info mb-5">
                <!-- 상품명 -->
                <h2><strong th:text="${productDetail.name}"></strong></h2>
                <!-- 적립 혜택 -->
                <p class="mt-3 benefit">
                    구매 혜택: 적립 포인트 5%<br>
                    배송비: 무료 배송
                </p>
                <!-- 상품 가격 -->
                <div>
                    <del class="regular_price">정상가:
                        <span th:text="${productDetail.regular_price}"></span><span>원</span>
                    </del>
                    <h4>
                        <p>할인율:&nbsp;<strong class="num_color_red mt-3" th:text="${productDetail.discount_percent}"></strong>%</p>
                        <p id="total-price">할인 적용가:&nbsp; <strong th:text="${productDetail.sale_price}"></strong> 원 </p>
                    </h4>
                </div>

                <!-- 수량 조절 -->
                <div class="quantity-container">
                    <button type="button" id="decrease-btn" class="btn btn-secondary">-</button>
                    <input type="text" id="quantity" value="1" th:data-stock="${productDetail.stock ?: 1}">
                    <button type="button" id="increase-btn" class="btn btn-secondary">+</button>
                </div>

                <!-- 버튼 -->
                <div class="mb-3">
                    <button type="button" id="cart" class="btn btn-outline-warning mr-3">장바구니</button>
                    <button type="button" id="buy" class="btn btn-outline-success">구매하기</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="container">
    <div class="row gy-4">
            <div class="member-info mb-3">
                <!-- 추가 정보 -->
                <div class="product_tab container" style=justify-content:center;>
                    <h2> <strong class="sort-item">제품 상세 정보</strong></h2>
                </div>
                <div style="text-align: center;">
                    <h5 class="mt-3" th:utext="${productDetail.info}"></h5>
<!--                    <img th:src="@{/img/product/{attach_info}(attach_info=${productDetail.attach_info})}" th:alt="${productDetail.attach_info}">-->
                </div>
            </div>
            <div>
                <button type="button" class="btn btn-outline-purple mr-3" th:onclick="history.go(-1)">목록으로</button>
            </div>
    </div>
</div>

<!-- Scroll Top -->
<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>


<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Custom Script -->
<script>
    $(document).ready(function () {
        // 가격 계산을 위해 기본 가격 추출
        const pricePerItem = parseInt($("#total-price").text().replace(/\D/g, ''));

        // 수량 변경에 따른 총 가격 업데이트
        function updateTotalPrice() {
            const quantity = parseInt($("#quantity").val());
            const totalPrice = pricePerItem * quantity;
            $("#total-price").text(`할인 적용가: ${totalPrice.toLocaleString()} 원`);
        }

        // 수량 증가 버튼
        $("#increase-btn").on("click", function () {
            // quantity 의 값을 가져와 int 로 파싱 값이 없거나, 유요한 값이 아닐때 기본값(1)을 설정
            const currentQuantity = parseInt($("#quantity").val()) || 1;
            // th:data - stock 으로 저장한 재고수량을 최대값으로 설정
            const maxQuantity = parseInt($("#quantity").attr("data-stock")||100); // 최대 기본값 설정.

            if (currentQuantity < maxQuantity) {
                $("#quantity").val(currentQuantity + 1);
                console.log("최대 수량:", maxQuantity); // 최대 수량 확인용
                updateTotalPrice();
            } else if (currentQuantity >= maxQuantity) {
                $("#quantity").val(maxQuantity); // 최대값 제한
                updateTotalPrice();
            }
        });

        // 수량 감소 버튼
        $("#decrease-btn").on("click", function () {
            const currentQuantity = parseInt($("#quantity").val() || 1);
            if (currentQuantity > 1) {
                $("#quantity").val(currentQuantity - 1);
                if (isNaN(currentQuantity) || currentQuantity < 1) {
                    $("#quantity").val(1); // 최소값 설정
                }
                updateTotalPrice();
            }
        });

        // 수량 입력 필드 직접 수정 이벤트
        $("#quantity").on("input", function () {
            // 입력필드 값 불러오기
            // this 는 클릭이벤트로 호출퇸 quantity 아이디값 이 속한 필드, 필드값 을 가져와서 Int 로 파싱
            let quantity = parseInt($(this).val());
            const maxQuantity = parseInt($(this).data("stock")); // 기본 최대값 설정
            // 입력 값이 비어있거나, 숫자로 변환할 수 없는 경우 NaN으로 판단.
            // 기본값 1로 설정해 비정상적인 입력을 방지.
            if (isNaN(quantity) || quantity < 1) {
                quantity = 1; // 최소값 설정
            } else if (quantity > maxQuantity) {
                quantity = maxQuantity; // 최대값 제한
            }
            $(this).val(quantity);
            updateTotalPrice();
        });

        // 장바구니 버튼 클릭
        $("#cart").on("click", function () {
            alert("장바구니에 상품이 추가되었습니다.");
        });

        // 구매하기 버튼 클릭
        $("#buy").on("click", function () {
            alert("구매 페이지로 이동합니다.");
        });
    });
</script>
</body>
</html>
